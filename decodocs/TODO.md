# TODO (DecoDocs)

_Last updated: January 29, 2026_

This file mirrors `decodocs-repo/docs/ROADMAP.md` and lists actionable engineering + documentation tasks.

## Phase 1 - Web MVP Foundation (Live, Iterating)
- [ ] Brand polish: ensure "DecoDocs" and "Snap Sign Pty Ltd" are consistent across UI + docs (no legacy names)
- [ ] Replace placeholder Sign page with real "signing MVP scope" copy + clear CTA (or hide until implemented)
- [ ] Add a visible "Free vs Pro" gating UX: explain *why* buttons are disabled + what upgrades unlock
- [ ] Harden analysis flow: loading/error/empty states for analysis results; avoid partial UI renders
- [ ] **Authentication: add comprehensive sign-in options (Email, Google + One Tap, Microsoft, Apple)**: support real accounts (and upgrading from anonymous) so users can unlock Pro, storage, and cross-device continuity.
  - [ ] Define the exact auth UX + states (no ambiguity)
    - Required entry points:
      - A visible “Sign in” button in the header/footer (always accessible)
      - A “Sign in to use analysis” CTA when gated actions are clicked
    - Required states:
      - Anonymous session (default)
      - Signed-in session (persistent)
      - “Link your anonymous session” flow (upgrade anonymous → real account)
      - Signed-out session (optional)
    - Acceptance criteria:
      - User can start anonymous, then link to Email/Google/Microsoft/Apple without losing the current document context.
  - [ ] Implement Email/Password auth (Firebase Auth)
    - Tasks:
      - Enable Email/Password provider in Firebase Console for project `snapsign-au`
      - Add UI: “Continue with email” → (create account / sign in / reset password)
      - Add validation rules (explicit):
        - Email must be RFC-like and non-empty
        - Password minimum length (set to 10) with strength hints
      - Add “reset password” email flow and success messaging
    - Acceptance criteria:
      - A user can create an account, sign in, sign out, and reset password from the UI.
  - [ ] Implement Google sign-in (Firebase Auth) + Google Identity Services “One Tap”
    - Tasks:
      - Enable Google provider in Firebase Console
      - Add “Continue with Google” button using Firebase `GoogleAuthProvider`
      - Add “Google One Tap” for eligible users using Google Identity Services (GIS):
        - Load GIS script only on public pages (e.g. Home) and only when not authenticated
        - Show One Tap prompt at most once per session unless user interacts
        - Provide a visible opt-out (dismiss) and respect dismissal for 7 days (localStorage)
      - Track analytics events (explicit names):
        - `auth_google_click`, `auth_google_success`, `auth_google_error`, `auth_one_tap_shown`, `auth_one_tap_success`, `auth_one_tap_dismissed`
    - Acceptance criteria:
      - Returning users see One Tap on Home (when not signed-in) and can complete sign-in without page navigation.
  - [ ] Implement Microsoft sign-in (Firebase Auth via OAuthProvider `microsoft.com`)
    - Tasks:
      - Create an Azure AD app registration with redirect URIs for:
        - `https://decodocs.com/__/auth/handler`
        - `https://snapsign.com.au/__/auth/handler` (if sharing the project’s auth domain)
        - Local dev emulator redirect URI (document the exact URL used)
      - Enable Microsoft provider in Firebase Console and configure client ID/secret
      - Add “Continue with Microsoft” button using Firebase `OAuthProvider('microsoft.com')`
      - Define requested scopes explicitly:
        - Minimum: `openid`, `email`, `profile`
        - Do not request Graph scopes unless Drive/OneDrive integration work begins
    - Acceptance criteria:
      - A new user can sign in with Microsoft and gets a stable Firebase `uid` with email attached (when available).
  - [ ] Implement Apple sign-in (Firebase Auth via OAuthProvider `apple.com`) with production-ready prerequisites
    - Tasks:
      - Create Apple Service ID + Key; configure:
        - Redirect URI(s) to Firebase auth handler for the production domain(s)
        - Domain verification (Apple requires verified domains)
      - Enable Apple provider in Firebase Console and configure:
        - Service ID, Team ID, Key ID, private key
      - Add “Continue with Apple” button using Firebase `OAuthProvider('apple.com')`
      - Handle Apple privacy behavior explicitly:
        - Email may be hidden/relay; treat `email` as optional and allow account management without email display
    - Acceptance criteria:
      - Apple sign-in works on Safari and Chrome, and doesn’t break when email is withheld.
  - [ ] Implement account linking + conflict handling (anonymous → provider)
    - Tasks (explicit behavior):
      - If user is anonymous and chooses a provider, link credentials to the existing user (`linkWithPopup` / `linkWithRedirect`)
      - If credentials already exist on another account:
        - show “This email is already in use. Sign in to that account to continue.” and offer provider sign-in
        - provide a safe merge strategy document (don’t auto-merge data silently)
    - Acceptance criteria:
      - Linking preserves user `uid` when possible; errors are handled with actionable UI (no raw Firebase error strings).
  - [ ] Update web auth state model and docs (source of truth)
    - Code references:
      - Current anonymous-only auth init: `decodocs-repo/web/src/context/AuthContext.jsx:3`, `decodocs-repo/web/src/context/AuthContext.jsx:73`
    - Tasks:
      - Expand `AuthContext` to expose: `signInWithEmail`, `signUpWithEmail`, `signInWithGoogle`, `signInWithMicrosoft`, `signInWithApple`, `signOut`, `linkCurrentUser`
      - Ensure emulator support still works (`VITE_USE_FIREBASE_EMULATOR`)
  - [ ] Add tests for auth flows (unit + e2e)
    - Unit:
      - Update/extend: `decodocs-repo/web/src/__tests__/AuthContext.test.jsx` to cover new methods and error cases
    - E2E (Playwright):
      - Add a mock auth mode test that simulates:
        - anonymous → link → authenticated, and analysis gating disappears
    - Acceptance criteria:
      - Tests run in CI without real provider credentials (mocked or emulator-based).
- [ ] Make environment setup unambiguous: one canonical place to define required `.env` variables and how to run locally
 - [ ] Implement Google Identity Services (GIS) in the web app for Google sign-in and token management
 - [ ] Configure Firebase Hosting 301 redirects so `https://decodocs-site.web.app` and `https://decodocs-site.firebaseapp.com` permanently redirect to `https://decodocs.com` (via `firebase.json` hosting settings)
- [ ] Testing:
  - [x] Expand Playwright: cover "auth failure still renders PDF", and "analysis buttons gated until authenticated"
  - [ ] Add CI-friendly `npm run test:unit` + `npm run test:e2e` runbook for the web app

## Phase 2 - Cloud Storage Integrations (Target: Q2 2026)
- [ ] Define the "Open vs Upload" contract (Free vs Pro) as a spec:
  - [ ] Default is ephemeral open (no storage)
  - [ ] Upload/save is explicit and paid (history/export)
  - [ ] Token revocation guarantees + audit logging expectations
- [ ] Google Drive (read-only):
  - [ ] OAuth consent + connect/disconnect UX
  - [ ] File picker -> open -> analyze pipeline
  - [ ] Token storage strategy (encrypted at rest; rotation/revocation)
- [ ] OneDrive (read-only):
  - [ ] Microsoft Graph integration + consistent UI with Drive
  - [ ] Cross-browser testing matrix
- [ ] iCloud Drive:
  - [ ] User-initiated file selection flow (Safari/iOS constraints)
  - [ ] Document open parity with local uploads
- [ ] Security checklist:
  - [ ] Least-privilege scopes (read-only)
  - [ ] No background sync or indexing
  - [ ] Clear user messaging about what is (not) stored

## Phase 3 - Paid Depth + Multi-Document (Target: Q3 2026)
- [ ] Define "Premium" value clearly (what's expensive and why):
  - [ ] DOCX conversion pipeline scope and limits
  - [ ] Multi-document session UX (bundle upload, ordering, references)
- [ ] Build multi-document analysis scaffolding:
  - [ ] Data model for bundles / references
  - [ ] UI for selecting which docs are in scope
  - [ ] Output schema for cross-document contradictions

## Phase 4 - Mobile Apps (Target: Q4 2026)
- [ ] Decide v1 architecture: WebView wrapper vs native shell + deep links
- [ ] Implement "Open in DecoDocs" from share sheet (iOS + Android)
- [ ] Establish auth + analytics parity with web (anonymous by default, upgrade path)
- [ ] Define v1 non-goals explicitly (offline, on-device inference, native signing)

## Phase 5 - Signing & Verification (Target: 2027+)
- [ ] Write a signing MVP spec:
  - [ ] What "sign" means (signature placement, audit trail, exports)
  - [ ] Envelope format + integrity checks
  - [ ] Legal/compliance assumptions and constraints by region
- [ ] Decide storage policy for signed artifacts (retention, export, deletion)

## Documentation Hygiene (Always On)
- [ ] Keep dates current across docs (avoid timelines stuck in 2025 when it's 2026+)
- [ ] Ensure roadmap claims match the code (mark items "specified" vs "implemented")
- [ ] Update test plans when selectors/UX change (`docs/test-plans/`)

## New Todos
- [ ] **Big Document Vector Management**: For big documents, RLM (Recursive Language Model) or other vector-based data management needs to be developed to efficiently handle large PDFs and document collections.
- [ ] **Refactor: split large UI components (maintainability)**: Reduce “god components” by extracting hooks + subcomponents so PDF viewing, analysis actions, and presentation concerns are separated.
  - [ ] Refactor `decodocs-repo/web/src/components/DocumentViewer.jsx` into smaller units
    - Why: this file mixes (1) PDF.js initialization/loading, (2) PDF render lifecycle, (3) Firebase callable orchestration, and (4) UI layout/wiring. It’s currently the largest UI module (~561 LOC).
    - Suggested extraction:
      - `usePdfJs()` / `usePdfLoader()` hook: PDF.js init + `loadPdfFromBlob` + `loadTestPdf`
      - `useDocumentAnalysis()` hook (or `services/analysisService.js`): `runPreflightCheck`, `handleAnalyzeDocument`, selection explain/highlight/translate actions
      - Keep `DocumentViewer` mostly as a container composing `PDFControls`, `PDFDisplay`, `AnalysisToolbox`, `AnalysisResults`
    - References:
      - Component + state: `decodocs-repo/web/src/components/DocumentViewer.jsx:17`
      - PDF.js init (worker + test PDF load): `decodocs-repo/web/src/components/DocumentViewer.jsx:63`
      - PDF loading: `decodocs-repo/web/src/components/DocumentViewer.jsx:95`
      - Preflight + analysis orchestration: `decodocs-repo/web/src/components/DocumentViewer.jsx:231`, `decodocs-repo/web/src/components/DocumentViewer.jsx:263`
      - UI composition boundary: `decodocs-repo/web/src/components/DocumentViewer.jsx:509`
  - [ ] Refactor `decodocs-repo/web/src/components/HomePage.jsx` by extracting page sections + moving content arrays out of the component
    - Why: large “marketing page” component tends to grow indefinitely; extracting `Hero`, `Features`, `Pricing`, `Roadmap`, etc. makes changes safer and improves readability.
    - Suggested extraction:
      - `components/home/*` section components (or similar)
      - Move `features`, `pricingTiers`, `roadmapItems` into a `homeContent.js` (or JSON) module
    - References:
      - Component start + event handlers: `decodocs-repo/web/src/components/HomePage.jsx:5`, `decodocs-repo/web/src/components/HomePage.jsx:17`
      - Static content arrays: `decodocs-repo/web/src/components/HomePage.jsx:79`, `decodocs-repo/web/src/components/HomePage.jsx:88`, `decodocs-repo/web/src/components/HomePage.jsx:129`
  - [ ] Refactor `decodocs-repo/web/src/components/DocumentEditor.jsx` into “editor shell” + “overlay/canvas” subcomponents
    - Why: the editor currently combines navigation, file selection, mode toggling, signature/annotation modeling, and rendering layout in one file (~379 LOC).
    - Suggested extraction:
      - `EditorToolbar` (file open, view, mode toggle)
      - `SignatureOverlay` / `AnnotationOverlay` components (render + event handling)
      - `useSignMode()` hook (signatures/annotations state + actions)
    - References:
      - Component start: `decodocs-repo/web/src/components/DocumentEditor.jsx:4`
      - File upload + navigation: `decodocs-repo/web/src/components/DocumentEditor.jsx:38`
      - Sign/annotation actions: `decodocs-repo/web/src/components/DocumentEditor.jsx:70`, `decodocs-repo/web/src/components/DocumentEditor.jsx:74`, `decodocs-repo/web/src/components/DocumentEditor.jsx:94`
  - [ ] Refactor `functions/index.js` by extracting Cloud Functions + shared helpers into modules
    - Why: `functions/index.js` is a single entry containing config/constants, auth/validation helpers, multiple callable functions, and a scheduled job (~461 LOC). Splitting improves testability and reduces merge conflicts.
    - Suggested extraction:
      - `functions/src/adminInit.js` (Admin init + emulator creds bootstrap)
      - `functions/src/validators.js` (auth, docHash, schema validation)
      - `functions/src/preflightCheck.js`, `functions/src/analyzeText.js`, `functions/src/getEntitlement.js`, `functions/src/cleanupOldUsageRecords.js`
      - Keep `functions/index.js` as a thin export/wiring file
    - References:
      - Admin init + helpers: `functions/index.js:8`, `functions/index.js:49`, `functions/index.js:67`, `functions/index.js:85`
      - Exports: `functions/index.js:108`, `functions/index.js:192`, `functions/index.js:393`, `functions/index.js:428`
- [ ] **Copy/SEO/UX: audit + rewrite all user-facing text (no ambiguity)**: Make DecoDocs’ messaging consistent, conversion-focused, and SEO-ready; remove placeholder/contradictory copy; ensure every label/link maps to a real user destination.
  - [ ] Define the single “north-star” one-liner + use it everywhere (exact replacements)
    - Why: the product tagline is currently inconsistent across entry points, which weakens brand recall and SEO relevance.
    - Decide one primary tagline (choose exactly one):
      - Option A (clarity-first): `Decode documents. Act with confidence.`
      - Option B (signing-adjacent): `Decode documents. Sign with clarity.`
    - Then update *all* occurrences to match the chosen tagline:
      - `decodocs-repo/web/src/components/Layout.jsx:21` (header tagline)
      - `decodocs-repo/web/src/components/AboutPage.jsx:11` (header tagline)
      - `decodocs-repo/web/src/components/HomePage.jsx:180` (hero headline currently differs)
      - `decodocs-repo/web/index.html:7` (HTML `<title>` currently differs)
      - `decodocs-repo/web/public/index.html:10` + `decodocs-repo/web/public/index.html:18` (legacy template meta/title currently differs)
    - Acceptance criteria:
      - A user sees the same tagline on Home, About, Viewer header, and browser tab title.
      - No “Act with confidence” vs “Sign with clarity” mismatch remains.
  - [ ] Rewrite the HomePage hero + “trust line” into precise, benefit-led copy (exact line edits)
    - Why: current hero is directionally good but mixes “Open” and “Sign” positioning; trust/privacy line is vague and can be interpreted as local-only processing.
    - Replace hero headline + subtitle with one of these *approved* sets (pick exactly one set and apply verbatim):
      - Set A (decision-first):
        - H1: `Understand what you’re about to sign.`
        - Subtitle: `Upload a PDF and get a plain‑language summary, key risks, and what to check—before you commit.`
      - Set B (risk-first):
        - H1: `Spot risks in contracts before you sign.`
        - Subtitle: `Plain‑English explanations, caveats, and inconsistencies—so you can decide confidently.`
    - Rewrite trust line to a factual, non-ambiguous statement (apply verbatim):
      - `Free: we don’t store your files. Pro: optional secure storage and deeper analysis.`
    - References:
      - Hero H1 + subtitle + CTAs + trust line: `decodocs-repo/web/src/components/HomePage.jsx:180`, `decodocs-repo/web/src/components/HomePage.jsx:181`, `decodocs-repo/web/src/components/HomePage.jsx:185`, `decodocs-repo/web/src/components/HomePage.jsx:192`
  - [ ] Fix HomePage navigation + footer links so every link works (no dead anchors)
    - Why: multiple links point to anchors that don’t exist, which is a trust and UX killer (and looks broken to crawlers).
    - Tasks (perform all):
      - Add `id="product"` to the section you want “Product” to scroll to (recommended: “How it works” section).
      - Replace `href="#privacy"` and `href="#terms"` with real routes (`/privacy`, `/terms`) and create those pages (see “Legal pages” task below).
      - Replace `href="#contact"` with a real route (`/contact`) or a `mailto:` link (choose one and use consistently across the app).
    - References:
      - HomePage nav uses `#product`: `decodocs-repo/web/src/components/HomePage.jsx:164`
      - HomePage footer anchors: `decodocs-repo/web/src/components/HomePage.jsx:356`
      - Layout footer anchors: `decodocs-repo/web/src/components/Layout.jsx:59`
      - AboutPage footer anchors: `decodocs-repo/web/src/components/AboutPage.jsx:110`
  - [ ] Make Pricing copy internally consistent and non-placeholder (align with real entitlement limits)
    - Why: pricing table contains ambiguous placeholders that reduce conversion and can create support issues.
    - Tasks (perform all):
      - Replace `N AI calls per document` with a real number or a precise bound; do not ship placeholders.
        - Recommended (matches current backend constants): `Up to 3 AI calls per document` for Pro.
      - Decide whether to expose Free/Pro limits publicly:
        - If yes: ensure Free and Pro limits match backend (`FREE_AI_CALLS_PER_DOC`, `PRO_AI_CALLS_PER_DOC`) and are reflected in tier bullets.
        - If no: remove numbers entirely and phrase as “limited” vs “more” (but still remove `N` placeholder).
      - Replace the pricing description sentence with a clearer value comparison (apply verbatim):
        - `Free covers the essentials. Pro adds deeper analysis, OCR for scanned PDFs, and optional storage.`
    - References:
      - Placeholder line: `decodocs-repo/web/src/components/HomePage.jsx:105`
      - Pricing description: `decodocs-repo/web/src/components/HomePage.jsx:287`
      - Backend limits source of truth: `functions/index.js:39`
  - [ ] Remove publicly-hostile wording from Roadmap and feature list (replace “kill feature” copy)
    - Why: “kill feature” reads as internal jargon and undermines trust; feature names should describe user value.
    - Tasks:
      - Replace `HubSpot capture (kill feature)` with a user-facing label (choose one):
        - `Optional lead capture (Pro)` OR `Team lead capture (optional)`
      - Replace `Email-to-sign + HubSpot capture` feature bullet with a user-value phrasing:
        - Recommended: `Email a PDF to start analysis (coming soon)`
    - References:
      - Feature bullet: `decodocs-repo/web/src/components/HomePage.jsx:85`
      - Roadmap item: `decodocs-repo/web/src/components/HomePage.jsx:135`
  - [ ] Replace the placeholder Sign page with a conversion-safe “Coming soon” page (exact content + CTA)
    - Why: “coming soon, check back later” is a dead end; use it to route users to the core value (analysis) or collect intent.
    - Tasks (perform all):
      - Replace copy with:
        - Title: `Sign PDFs (Coming soon)`
        - Body: `We’re building a signing workflow with audit trail and verification. In the meantime, you can analyze a PDF before you sign.`
      - Replace “Go Back” CTA with two clear CTAs:
        - Primary: `Analyze a PDF` → navigates to `/` and triggers the “Open PDF” flow
        - Secondary: `Join the waitlist` → navigates to `/contact` (or opens `mailto:contact@snapsign.com` with subject `DecoDocs signing waitlist`)
    - References:
      - Current placeholder: `decodocs-repo/web/src/App.jsx:13`, `decodocs-repo/web/src/App.jsx:18`
  - [ ] Improve microcopy for AI feature gating (remove technical language, add “why” + next step)
    - Why: current UI surfaces “Firebase” and uses blocking `alert()`; users need plain language and clear action.
    - Tasks:
      - Replace header auth banner strings with user-friendly wording that avoids internal terms:
        - Replace `✅ Firebase authenticated - AI features available` with `Connected — analysis tools are ready.`
        - Replace `⚠️ Authenticating with Firebase...` with `Connecting…`
        - Replace `⚠️ AI calls disabled: "...". Document viewing features remain available.` with `Analysis is temporarily unavailable. You can still view PDFs.`
      - Replace `alert()` flows with non-blocking UI copy (toast/inline message) and include:
        - A short reason (e.g. “Sign in required”, “Pro required for scanned PDFs”, “Limit reached”)
        - A next action (e.g. “Upgrade”, “Try another document”, “Retry”)
    - References:
      - Banner strings: `decodocs-repo/web/src/components/Layout.jsx:35`
      - Current alerts: `decodocs-repo/web/src/components/DocumentViewer.jsx:281`, `decodocs-repo/web/src/components/DocumentViewer.jsx:349`, `decodocs-repo/web/src/components/HomePage.jsx:43`
      - Auth error card: `decodocs-repo/web/src/components/AuthErrorNotification.jsx:37`
  - [ ] Add “Not legal advice” disclaimer consistently where decisions happen (Home + Viewer + About)
    - Why: this reduces legal ambiguity and sets correct expectations at the moment users rely on results.
    - Tasks:
      - Add a short disclaimer block (apply verbatim):
        - `DecoDocs provides informational analysis and is not legal advice. For legal decisions, consult a qualified professional.`
      - Place it in:
        - HomePage near Pricing (below pricing explanation)
        - DocumentViewer near Analysis results panel (above “Analysis Results” header)
        - About page (in the “What DecoDocs Is — and Is Not” section)
    - References:
      - Pricing section: `decodocs-repo/web/src/components/HomePage.jsx:283`
      - Analysis results panel render: `decodocs-repo/web/src/components/DocumentViewer.jsx:550`
      - About “Is Not”: `decodocs-repo/web/src/components/AboutPage.jsx:53`
  - [ ] SEO basics: define one canonical title/description + OpenGraph/Twitter meta (exact fields)
    - Why: current HTML head is minimal and inconsistent between `web/index.html` and `web/public/index.html`; crawlers and link previews need stable metadata.
    - Tasks:
      - Choose one canonical title (≤ 60 chars) and one meta description (≤ 155 chars) and implement them in `web/index.html`.
        - Recommended title: `DecoDocs — Understand documents before you sign`
        - Recommended description: `Upload a PDF to get plain‑English explanations, risks, and what to check—before you sign. Free tier available.`
      - Add OpenGraph + Twitter meta tags in `web/index.html`:
        - `og:title`, `og:description`, `og:type=website`, `og:url`, `og:image`
        - `twitter:card=summary_large_image`, `twitter:title`, `twitter:description`, `twitter:image`
      - Remove or align the legacy template file `web/public/index.html` (pick one):
        - Option A: delete it to avoid confusion, OR
        - Option B: keep it but ensure it matches `web/index.html` exactly (title + description + icons)
    - References:
      - Current Vite title: `decodocs-repo/web/index.html:7`
      - Current legacy description/title: `decodocs-repo/web/public/index.html:9`, `decodocs-repo/web/public/index.html:18`
  - [ ] Create real Legal/Contact pages with scoped, copy-complete content (no placeholders)
    - Why: links exist across multiple pages but don’t resolve; legal/trust pages improve conversion and reduce support.
    - Tasks (perform all):
      - Add `/privacy` page with:
        - What is processed (PDF + extracted text), what is stored (Free vs Pro), retention, user controls (delete/export), and contact email.
      - Add `/terms` page with:
        - Service scope, “not legal advice”, acceptable use, limitation of liability, and change notice.
      - Add `/contact` page with:
        - 1-sentence prompt, email address, and (optional) waitlist mailto CTA for signing.
      - Update all footers/navs to point to these routes (replace `#privacy/#terms/#contact`).
    - References:
      - Broken footer links: `decodocs-repo/web/src/components/HomePage.jsx:356`, `decodocs-repo/web/src/components/Layout.jsx:59`, `decodocs-repo/web/src/components/AboutPage.jsx:110`
- [ ] **Make DecoDocs available via MCP (Model Context Protocol) as a “document decode service”**: expose safe, well-scoped tools that let MCP clients upload a document, request analysis, and retrieve results with clear limits and privacy guarantees.
  - Goal (non-ambiguous): an MCP client (Cursor/Claude Desktop/etc.) can connect to a local/hosted MCP server and call `decodocs.decode_document(...)` to get structured analysis JSON, with optional “explain selection” and “risk highlights” tools.
  - [ ] Decide MCP deployment model and document it (pick exactly one)
    - Option A (recommended initially): **local MCP server** that calls existing HTTP/Firebase endpoints; no secrets shipped to clients; users authenticate with Firebase and provide an ID token.
    - Option B: **hosted MCP server** (VPS) that verifies auth and runs decode pipelines server-side.
    - Acceptance criteria:
      - A single command starts the MCP server (e.g. `npm run mcp` or `python -m decodocs_mcp`).
      - A README section shows exact setup steps, required env vars, and example tool calls.
  - [ ] Define the MCP tool surface (final names + schemas)
    - Tools (minimum set):
      - `decodocs.health()` → `{ ok: boolean, version: string }`
      - `decodocs.decode_document({ filename, content_base64, options })` → `{ doc_id, summary, risks[], recommendations[], usage }`
      - `decodocs.preflight({ filename, content_base64 })` → `{ classification, reasons[], limits }`
    - Optional tools (if supported by backend):
      - `decodocs.explain_selection({ doc_id, selection_text })`
      - `decodocs.highlight_risks({ doc_id })`
    - Acceptance criteria:
      - Each tool has deterministic input validation and a stable JSON output schema (versioned).
  - [ ] Decide and implement authentication and authorization (no ambiguity)
    - Required behavior:
      - Every tool call must include either a Firebase ID token or an API key that maps to an account (choose one).
      - Server verifies the token on each request and scopes access by `uid`.
      - Rate limiting and per-doc AI budgets are enforced server-side (no client trust).
    - References (current auth model):
      - Firebase Auth usage: `decodocs-repo/web/src/context/AuthContext.jsx`
      - Callable functions enforcing auth: `functions/index.js:108`
  - [ ] Implement document ingestion strategy for MCP (pick exactly one)
    - Option A (simple): pass the full PDF as base64 to the MCP server, then:
      - extract text server-side (preferred) OR
      - call the existing “analyzeText” function with pre-extracted text (least change)
    - Option B (scalable): upload to object storage via pre-signed URL and pass `fileKey`/`docHash` to decode (aligns with `decodocs-repo/web/AGENTS.md` architecture).
    - Acceptance criteria:
      - Maximum input size is documented and enforced (hard limit + friendly error).
      - No documents are stored unless the user explicitly requests storage (Free vs Pro contract).
  - [ ] Add a clear privacy and indexing policy for MCP usage
    - Tasks:
      - Add “Data handling” section: what is sent, what is stored, retention, and how to delete.
      - Ensure MCP server never logs raw document content by default (only docHash + metadata).
      - Add a config flag to enable/disable telemetry logging.
  - [ ] Provide end-to-end examples (copy/paste runnable)
    - Examples to include:
      - Decode a PDF and print “Top 5 risks”
      - Explain a highlighted clause
      - Handle Pro-required (scanned PDF) response gracefully
    - Acceptance criteria:
      - Examples run without code edits (only env vars and a sample PDF).
